# 音绘星·自闭症儿童认知能力结构化提升系统 V1.0 设计说明书（A4版｜含术语表/缩略语表/ASCII流程图）

> 说明：本文档为中国软件著作权登记常用“设计说明书/技术说明书”材料示例，已按软著常见目录结构编写。本版本不填写真实单位与个人信息，均用占位符表示，可直接复制到 Word 排版提交。

---

## 封面信息（占位符）
- 软件名称：音绘星·自闭症儿童认知能力结构化提升系统  
- 版本号：V1.0  
- 著作权人/单位：【著作权人/单位名称】  
- 开发完成日期：【YYYY-MM-DD】  
- 首次发表日期：【未发表/YYYY-MM-DD】  
- 文档名称：设计说明书  
- 文档版本：V1.0  
- 编写日期：【YYYY-MM-DD】  

（封面下方留空用于盖章/签字，如需要）

---

## 页眉页脚设置建议（Word）
- 页眉（居中）：音绘星·自闭症儿童认知能力结构化提升系统 V1.0 设计说明书  
- 页脚（居中）：第 x 页 / 共 y 页  

---

## 目录（A4排版用）
1 简介  
　1.1 编写目的  
　1.2 使用对象  
　1.3 产品范围  
2 术语表与缩略语表  
　2.1 术语表  
　2.2 缩略语表  
3 产品概述  
　3.1 总体框架  
　3.2 系统架构  
　3.3 主要文件与目录结构  
4 功能与模块说明  
　4.1 学习目标设置模块  
　4.2 目标分解模块  
　4.3 歌词生成模块（儿歌特点优化）  
　4.4 图片生成模块（绘本风格与角色融入）  
　4.5 音乐生成模块（约40秒）  
　4.6 学习步骤导航与展示模块（固定高度展示）  
　4.7 内容保存模块  
　4.8 错误处理与日志模块  
5 业务流程说明（ASCII流程图）  
　5.1 整体业务流程  
　5.2 单步内容生成流程  
　5.3 音乐生成轮询流程  
　5.4 资源访问与缓存流程  
6 对外接口说明  
　6.1 与终端（浏览器）交互接口  
　6.2 与第三方AI服务接口  
7 运行环境与部署说明  
　7.1 运行环境  
　7.2 本地部署与启动  
　7.3 云部署（Vercel）说明  
8 安全性与合规性说明（适龄内容与数据处理）  
9 软件功能摘要（软著申请用简述）  

---

# 1 简介

## 1.1 编写目的
本文档用于说明《音绘星·自闭症儿童认知能力结构化提升系统 V1.0》（以下简称“音绘星系统”）的设计目标、系统结构、主要功能模块、业务流程、接口与运行环境，为中国软件著作权登记提供技术说明材料，同时为系统部署、维护与后续升级提供参考。

## 1.2 使用对象
- 软件著作权登记审核人员  
- 产品/项目管理人员  
- 软件开发与运维人员  
- 教师、家长、康复训练辅助人员（使用参考）

## 1.3 产品范围
音绘星系统面向3–6岁儿童（尤其是自闭症儿童认知训练场景），提供“输入学习目标 → 分解学习步骤 → 多模态内容生成（歌词/图片/音乐） → 分步展示与保存”的完整能力。系统形态为Web应用，可本地运行或部署到云平台（例如Vercel）。

---

# 2 术语表与缩略语表

## 2.1 术语表
| 术语 | 说明 |
|---|---|
| 认知训练 | 针对儿童对事物形状、功能、概念、规则等的理解与记忆能力的训练活动 |
| 学习目标 | 用户（家长/老师）希望儿童掌握的主题，如“认识钟表”“认识手机” |
| 目标重点 | 对学习目标中需突出掌握的关键点描述，如“认识指针、数字、时段” |
| 学习步骤 | 系统自动生成的循序渐进学习单元（通常3–5步） |
| 儿歌歌词 | 符合3–6岁儿童歌曲特点、重复易记、教育性明确的歌词文本 |
| 绘本插图 | 适龄、安全、温暖、简洁风格的图片，用于辅助儿童认知理解 |
| 角色（乐乐） | 学习陪伴角色，用于增强代入感与持续关注（通过提示词约束一致性） |
| 生成任务 | 调用第三方服务后产生的异步任务（如音乐生成需轮询任务状态） |
| 轮询 | 客户端定时查询任务状态直到完成或失败的一种机制 |
| 缓存/预加载 | 在切换步骤前提前加载图片资源，减少等待时间 |

## 2.2 缩略语表
| 缩略语 | 全称 | 说明 |
|---|---|---|
| UI | User Interface | 用户界面 |
| API | Application Programming Interface | 应用程序接口 |
| LLM | Large Language Model | 大语言模型 |
| CORS | Cross-Origin Resource Sharing | 跨域资源共享 |
| JSON | JavaScript Object Notation | 数据交换格式 |
| OSS | Object Storage Service | 对象存储服务 |
| URL | Uniform Resource Locator | 资源定位地址 |

---

# 3 产品概述

## 3.1 总体框架
系统采用“前端单页 + 后端轻量服务代理”的架构：
- 前端（index.html）：  
  - 负责界面呈现、参数配置、流程控制、结果展示、缓存与预加载。  
  - 特点：适龄化UI（柔和配色、圆角卡片、大字号）、歌词与图片区域固定高度展示（928px）。
- 后端（server.js）：  
  - 负责提供HTTP服务、代理第三方AI请求（隐藏Key/统一跨域/统一错误返回）、保存生成内容。
- 提示词工程（prompts.js）：  
  - 负责目标分解与歌词生成的提示词模板，约束儿歌特点、安全要求、结构化输出。

## 3.2 系统架构
- 表现层：浏览器端渲染UI与交互  
- 业务层：前端JS控制生成流程与步骤切换  
- 服务层：后端API代理与落盘保存  
+- 第三方能力层：DashScope文本/图像；Suno(defapi)音乐

## 3.3 主要文件与目录结构
```
.
├── index.html          # 前端页面（UI + 业务逻辑）
├── server.js           # 后端服务（API代理、保存、日志）
├── prompts.js          # 提示词工程（分解、歌词）
├── yinhuixing.png      # Logo
├── vercel.json         # Vercel部署配置
├── package.json        # Node项目配置
└── data/               # 生成内容保存目录（运行后生成）
```

---

# 4 功能与模块说明

## 4.1 学习目标设置模块
- 输入学习目标与目标重点  
- 选择/自定义：音乐风格、音乐声音、绘本风格、角色类型  
- 输出参数用于目标分解与内容生成

## 4.2 目标分解模块
- 将学习目标分解为3–5个步骤  
- 输出结构化JSON：step_number、step_name、step_description、learning_objective、character_name、character_description（20字以内）  
- 强调适龄与安全：避免恐怖、暴力、危险等内容

## 4.3 歌词生成模块（儿歌特点优化）
- 目标：生成更符合儿歌特点的歌词，而非口号式短句  
- 特点：重复句、叠词、拟声词，行长有变化（更自然），教育目标明确  
- 时长：约40秒（35–45秒）  
- 输出格式：带[Verse]/[Chorus]标签的纯歌词文本

## 4.4 图片生成模块（绘本风格与角色融入）
- 生成1664×928绘本插图  
- 风格参数：童话/可爱/科幻/童年/自定义  
- 内容约束：温暖、安全、明亮、简洁，突出学习对象  
- 角色融入：画面包含“乐乐”，并尽量跨步骤一致  
- 展示要求：图片区域高度固定928px，按原始1664×928全尺寸渲染

## 4.5 音乐生成模块（约40秒）
- 根据歌词生成约40秒音乐  
- 支持风格与声音类型  
- 生成机制：提交任务→轮询查询→获取audio_url

## 4.6 学习步骤导航与展示模块（固定高度展示）
- 步骤指示器、上一步/下一步、重新生成  
- 歌词区域高度固定928px  
- 图片区域高度固定928px  
- 图片按原始像素显示（1664×928），保证全尺寸输出

## 4.7 内容保存模块
- 保存歌词/图片/音频到data/session_xxx  
- 便于归档、复用、导出

## 4.8 错误处理与日志模块
- 后端记录请求与响应日志  
- 外部服务超时/失败时返回规范JSON，不崩溃  
- 前端显示错误提示

---

# 5 业务流程说明（ASCII流程图）

## 5.1 整体业务流程
```
+--------------------+
|   用户打开网页UI   |
+---------+----------+
          |
          v
+---------------------------+
| 输入学习目标/重点/风格等 |
+-------------+-------------+
              |
              v
+---------------------------+
| 点击“分解学习目标”按钮  |
+-------------+-------------+
              |
              v
+---------------------------+
| POST /api/decompose-prompt|
+-------------+-------------+
              |
              v
+---------------------------+
| 返回 steps + 角色信息     |
+-------------+-------------+
              |
              v
+---------------------------+
| 自动生成所有步骤内容      |
| (歌词 + 图片 + 音乐)      |
+-------------+-------------+
              |
              v
+---------------------------+
| 展示步骤1（可导航切换）  |
+-------------+-------------+
              |
              v
+---------------------------+
| 保存到 data/（可选）      |
+---------------------------+
```

## 5.2 单步内容生成流程
```
+------------------------+
| 选择 stepIndex 的 step |
+-----------+------------+
            |
            v
+------------------------------+
| POST /api/generate-lyrics    |
+-----------+------------------+
            |
            v
+------------------------------+
| 并行执行：                   |
| 1) POST /api/generate-image  |
| 2) POST /api/suno/submit/music|
+-----------+------------------+
            |
            v
+------------------------------+
| 轮询 GET /api/suno/fetch     |
| 直到拿到 audio_url 或超时    |
+-----------+------------------+
            |
            v
+------------------------------+
| 写入缓存 stepContents[index] |
| 并刷新UI显示                 |
+------------------------------+
```

## 5.3 音乐生成轮询流程
```
+---------------------------+
| 提交音乐生成 submit/music |
+-------------+-------------+
              |
              v
+---------------------------+
| 获取 taskId               |
+-------------+-------------+
              |
              v
+---------------------------+
| 循环轮询 fetch?id=taskId  |
|  - status in_progress     |
|  - audio_url == null      |
+-------------+-------------+
              |
      audio_url出现?
        /     \
      否       是
      |         |
      v         v
  等待5秒   返回 audio_url
      |
      +-----> 继续轮询
```

## 5.4 资源访问与缓存流程
```
+----------------------+
| stepContents 有image?|
+----------+-----------+
           |
           v
+------------------------------+
| preload 当前图 + 下一步的图  |
| (Image对象预加载并缓存Promise)|
+--------------+---------------+
               |
               v
+------------------------------+
| 用户点击“下一步”             |
+--------------+---------------+
               |
               v
+------------------------------+
| 若图片已预加载 -> 快速显示   |
| 否则显示占位 -> onload替换   |
+------------------------------+
```

---

# 6 对外接口说明

## 6.1 与终端（浏览器）交互接口（HTTP/JSON）
- `POST /api/decompose-prompt`  
  入参：userGoal、learningFocus、musicStyle、musicVoice、pictureBookStyle、characterType  
  出参：steps、character_name、character_description
- `POST /api/generate-lyrics`  
  入参：step、characterName、musicStyle、musicVoice、stepNumber、totalSteps  
  出参：lyrics
- `POST /api/generate-image`  
  入参：prompt、size、negative_prompt  
  出参：image_url
- `POST /api/suno/submit/music`  
  入参：prompt(歌词)、title、tags等  
  出参：taskId
- `GET /api/suno/fetch?id=...`  
  出参：任务状态、audio_url等
- `POST /api/save-content`  
  入参：stepIndex、lyrics、imageUrl、audioUrl、sessionId  
  出参：保存结果

## 6.2 与第三方AI服务接口
- DashScope 文本生成：文本生成接口（LLM）  
- DashScope 图像生成：文生图接口（qwen-image）  
- defapi/Suno：音乐生成与任务查询接口

---

# 7 运行环境与部署说明

## 7.1 运行环境
- Node.js：>= 18（建议 20+）  
- 浏览器：Chrome/Edge 最新版  
- 网络：可访问 DashScope 与 defapi/Suno 服务

## 7.2 本地部署与启动
1. 进入项目目录  
2. 启动：`node server.js`  
3. 访问：`http://localhost:5173`

## 7.3 云部署（Vercel）说明
- 项目包含 vercel.json、package.json  
- 支持 GitHub 导入一键部署  
- 如需环境变量，可在 Vercel 控制台配置

---

# 8 安全性与合规性说明
- 生成内容强调适龄、安全、温暖，避免恐惧、暴力、危险物品、负面刺激  
- 默认不采集个人隐私信息  
- 内容保存仅落盘到本地 data 目录（可按需关闭或清理）

---

# 9 软件功能摘要（软著申请用简述）
音绘星系统是一款面向3–6岁儿童的认知学习辅助软件。用户输入学习目标与重点后，系统自动分解为循序渐进的学习步骤，并为每个步骤生成适龄儿歌歌词、绘本插图与约40秒音乐，支持逐步展示、音频播放与内容保存归档，帮助儿童在温暖直观的多模态内容中完成认知训练。

---

【提示】  
- 以上为“设计说明书/技术说明书”内容，可直接复制到 Word。  
- A4 页面建议：页边距上/下2.5cm，左3cm，右2.5cm；正文宋体小四（12pt），行距1.5倍；标题黑体分级。  
- 若还需单独的《用户手册（A4版）》或需要插入截图占位，请告知。  
